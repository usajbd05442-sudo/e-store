<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PyShop - User Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    .cart-badge{
      position:absolute; top:-8px; right:-8px;
      background:#ef4444; color:#fff; border-radius:999px;
      width:20px; height:20px; font-size:12px;
      display:flex; align-items:center; justify-content:center;
    }
    .modal{ transition:opacity .25s ease; }
    .product-card{ transition:all .25s ease; }
    .product-card:hover{ transform:translateY(-4px); box-shadow:0 20px 25px -5px rgba(0,0,0,.1); }
    .toast{ animation:slideIn .25s ease, fadeOut .25s ease 2.7s; }
    @keyframes slideIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }
    @keyframes fadeOut { from{opacity:1} to{opacity:0} }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">
  <!-- NAV -->
  <nav class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-2">
          <i class="fab fa-python text-3xl"></i>
          <h1 class="text-2xl font-bold">PyShop</h1>
        </div>

        <div class="flex items-center space-x-4">
          <div class="relative hidden md:block">
            <input id="searchInput" type="text" placeholder="Search products..."
              class="px-4 py-2 rounded-full text-gray-800 w-72 focus:outline-none focus:ring-2 focus:ring-purple-300"/>
            <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
          </div>

          <button onclick="showCart()" class="relative p-2 hover:bg-white/20 rounded-full transition" title="Cart">
            <i class="fas fa-shopping-cart text-xl"></i>
            <span id="cartBadge" class="cart-badge hidden">0</span>
          </button>

          <button onclick="showOrders()" class="p-2 hover:bg-white/20 rounded-full transition" title="Orders">
            <i class="fas fa-box text-xl"></i>
          </button>

          <a href="./admin.html" class="p-2 hover:bg-white/20 rounded-full transition" title="Admin (new page)">
            <i class="fas fa-user-shield text-xl"></i>
          </a>
        </div>
      </div>

      <div class="md:hidden mt-3 relative">
        <input id="searchInputMobile" type="text" placeholder="Search products..."
          class="w-full px-4 py-2 rounded-full text-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-300"/>
        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
      </div>
    </div>
  </nav>

  <!-- CATEGORY FILTER -->
  <div class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex space-x-3 overflow-x-auto">
        <button onclick="filterCategory('all')" data-category="all"
          class="category-btn px-4 py-2 rounded-full bg-indigo-600 text-white font-medium">All</button>
        <button onclick="filterCategory('electronics')" data-category="electronics"
          class="category-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
          <i class="fas fa-laptop mr-2"></i>Electronics
        </button>
        <button onclick="filterCategory('clothing')" data-category="clothing"
          class="category-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
          <i class="fas fa-tshirt mr-2"></i>Clothing
        </button>
        <button onclick="filterCategory('home')" data-category="home"
          class="category-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
          <i class="fas fa-home mr-2"></i>Home
        </button>
        <button onclick="filterCategory('sports')" data-category="sports"
          class="category-btn px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300">
          <i class="fas fa-futbol mr-2"></i>Sports
        </button>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <div class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white py-14">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <h2 class="text-4xl font-bold mb-3">Welcome to PyShop</h2>
      <p class="text-lg mb-6 opacity-95">Products admin se manage hotay hain (admin.html) â€” changes yahan show hotay rahen ge.</p>
      <div class="flex justify-center flex-wrap gap-3">
        <span class="bg-white/20 px-4 py-2 rounded-full"><i class="fas fa-shipping-fast mr-2"></i>Free Shipping</span>
        <span class="bg-white/20 px-4 py-2 rounded-full"><i class="fas fa-undo mr-2"></i>Easy Returns</span>
        <span class="bg-white/20 px-4 py-2 rounded-full"><i class="fas fa-lock mr-2"></i>Secure Payment (demo)</span>
      </div>
    </div>
  </div>

  <!-- PRODUCTS -->
  <main class="max-w-7xl mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-5">
      <h3 class="text-2xl font-bold text-gray-800">Products</h3>
      <span id="productsMeta" class="text-sm text-gray-500"></span>
    </div>

    <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
  </main>

  <!-- CART MODAL -->
  <div id="cartModal" class="modal fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 flex justify-between items-center">
        <h2 class="text-xl font-bold"><i class="fas fa-shopping-cart mr-2"></i>Your Cart</h2>
        <button onclick="hideCart()" class="hover:bg-white/20 p-2 rounded-full"><i class="fas fa-times"></i></button>
      </div>
      <div id="cartItems" class="p-6 overflow-y-auto max-h-96"></div>
      <div class="border-t px-6 py-4 bg-gray-50">
        <div class="flex justify-between items-center mb-4">
          <span class="text-lg font-semibold">Total:</span>
          <span id="cartTotal" class="text-2xl font-bold text-indigo-600">$0.00</span>
        </div>
        <button onclick="checkout()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl font-semibold hover:opacity-90 transition">
          <i class="fas fa-credit-card mr-2"></i>Proceed to Checkout
        </button>
      </div>
    </div>
  </div>

  <!-- CHECKOUT MODAL -->
  <div id="checkoutModal" class="modal fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 flex justify-between items-center">
        <h2 class="text-xl font-bold"><i class="fas fa-credit-card mr-2"></i>Checkout</h2>
        <button onclick="hideCheckout()" class="hover:bg-white/20 p-2 rounded-full"><i class="fas fa-times"></i></button>
      </div>

      <form id="checkoutForm" class="p-6 space-y-4">
        <div>
          <label class="block text-gray-700 font-medium mb-2">Full Name</label>
          <input id="coName" type="text" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-2">Email</label>
          <input id="coEmail" type="email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
        </div>
        <div>
          <label class="block text-gray-700 font-medium mb-2">Address</label>
          <textarea id="coAddress" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" rows="2"></textarea>
        </div>

        <div class="border-t pt-4">
          <div class="flex justify-between items-center mb-4">
            <span class="font-semibold">Order Total:</span>
            <span id="checkoutTotal" class="text-xl font-bold text-indigo-600">$0.00</span>
          </div>
          <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-xl font-semibold hover:opacity-90 transition">
            <i class="fas fa-check mr-2"></i>Place Order
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ORDERS MODAL -->
  <div id="ordersModal" class="modal fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 flex justify-between items-center">
        <h2 class="text-xl font-bold"><i class="fas fa-box mr-2"></i>Your Orders</h2>
        <button onclick="hideOrders()" class="hover:bg-white/20 p-2 rounded-full"><i class="fas fa-times"></i></button>
      </div>
      <div id="ordersList" class="p-6 overflow-y-auto max-h-96"></div>
    </div>
  </div>

  <!-- PRODUCT DETAIL MODAL -->
  <div id="productModal" class="modal fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl overflow-hidden relative">
      <div id="productDetail" class="p-6"></div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toastContainer" class="fixed top-20 right-4 z-50 space-y-2"></div>

  <footer class="bg-gray-800 text-white py-8 mt-12">
    <div class="max-w-7xl mx-auto px-4 text-center text-gray-300">
      <p>&copy; 2024 PyShop (Demo). Admin: <span class="text-white">admin.html</span></p>
    </div>
  </footer>

  <script>
    // =============================
    // STORAGE KEYS (shared with admin.html)
    // =============================
    const STORAGE_KEY_PRODUCTS = "pyshop_products_v1";
    const STORAGE_KEY_CART = "pyshop_cart_v1";
    const STORAGE_KEY_ORDERS = "pyshop_orders_v1";

    // Default products (sirf tab use honge jab storage empty ho)
    const DEFAULT_PRODUCTS = [
      { id: 1, name: "Wireless Headphones", price: 79.99, category: "electronics", image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop", rating: 4.5, stock: 50, description: "Premium wireless headphones with noise cancellation and 30-hour battery life." },
      { id: 2, name: "Smart Watch Pro", price: 199.99, category: "electronics", image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=300&h=300&fit=crop", rating: 4.8, stock: 30, description: "Advanced smartwatch with health monitoring, GPS, and 7-day battery." },
      { id: 3, name: "Bluetooth Mouse", price: 49.99, category: "electronics", image: "https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=300&h=300&fit=crop", rating: 4.3, stock: 100, description: "Smooth Bluetooth mouse with ergonomic grip and long battery." },
      { id: 4, name: "Mechanical Keyboard", price: 129.99, category: "electronics", image: "https://images.unsplash.com/photo-1511467687858-23d96c32e4ae?w=300&h=300&fit=crop", rating: 4.7, stock: 45, description: "RGB mechanical keyboard with tactile switches and programmable keys." },
      { id: 5, name: "Cotton T-Shirt", price: 24.99, category: "clothing", image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=300&h=300&fit=crop", rating: 4.2, stock: 200, description: "Comfortable 100% organic cotton t-shirt." },
      { id: 6, name: "Denim Jacket", price: 89.99, category: "clothing", image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=300&h=300&fit=crop", rating: 4.6, stock: 60, description: "Classic denim jacket with modern fit and vintage wash." },
      { id: 7, name: "Running Shoes", price: 119.99, category: "sports", image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop", rating: 4.9, stock: 80, description: "Lightweight running shoes with responsive cushioning." },
      { id: 8, name: "Yoga Mat", price: 34.99, category: "sports", image: "https://images.unsplash.com/photo-1601925260368-ae2f83cf8b7f?w=300&h=300&fit=crop", rating: 4.4, stock: 150, description: "Non-slip yoga mat with carrying strap." },
      { id: 9, name: "Plant Pot Set", price: 29.99, category: "home", image: "https://images.unsplash.com/photo-1485955900006-10f4d324d411?w=300&h=300&fit=crop", rating: 4.5, stock: 90, description: "Set of 3 ceramic plant pots with drainage holes." },
      { id: 10, name: "LED Desk Lamp", price: 44.99, category: "home", image: "https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=300&h=300&fit=crop", rating: 4.6, stock: 70, description: "Adjustable LED desk lamp with touch controls." }
    ];

    // -----------------------------
    // helpers for localStorage
    // -----------------------------
    function readJSON(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);
      } catch {
        return fallback;
      }
    }
    function writeJSON(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    function ensureProductsSeeded() {
      const existing = readJSON(STORAGE_KEY_PRODUCTS, null);
      if (!Array.isArray(existing) || existing.length === 0) {
        writeJSON(STORAGE_KEY_PRODUCTS, DEFAULT_PRODUCTS);
      }
    }

    // -----------------------------
    // "API" layer (front-end only)
    // -----------------------------
    const API = {
      getProducts(category = "all", search = "") {
        const products = readJSON(STORAGE_KEY_PRODUCTS, []);
        let list = [...products];
        if (category !== "all") list = list.filter(p => p.category === category);
        if (search) {
          const q = search.toLowerCase().trim();
          list = list.filter(p => (p.name || "").toLowerCase().includes(q));
        }
        return list;
      },
      getProduct(id) {
        const products = readJSON(STORAGE_KEY_PRODUCTS, []);
        return products.find(p => p.id === id) || null;
      },
      getCart() {
        return readJSON(STORAGE_KEY_CART, []);
      },
      saveCart(cart) {
        writeJSON(STORAGE_KEY_CART, cart);
      },
      getOrders() {
        return readJSON(STORAGE_KEY_ORDERS, []);
      },
      saveOrders(orders) {
        writeJSON(STORAGE_KEY_ORDERS, orders);
      },
      saveProducts(products) {
        writeJSON(STORAGE_KEY_PRODUCTS, products);
      }
    };

    // =============================
    // UI / APP
    // =============================
    let currentCategory = "all";

    document.addEventListener("DOMContentLoaded", () => {
      ensureProductsSeeded();
      loadProducts();
      updateCartBadge();

      const searchInput = document.getElementById("searchInput");
      const searchInputMobile = document.getElementById("searchInputMobile");

      if (searchInput) {
        searchInput.addEventListener("input", (e) => loadProducts(currentCategory, e.target.value));
      }
      if (searchInputMobile) {
        searchInputMobile.addEventListener("input", (e) => loadProducts(currentCategory, e.target.value));
      }

      document.getElementById("checkoutForm").addEventListener("submit", (e) => {
        e.preventDefault();
        placeOrder();
      });

      // Live update when admin changes products in another tab/window
      window.addEventListener("storage", (e) => {
        if (e.key === STORAGE_KEY_PRODUCTS) {
          loadProducts(currentCategory, getSearchQuery());
          showToast("Products updated (Admin changes)", "info");
        }
      });
    });

    function getSearchQuery() {
      const desktop = document.getElementById("searchInput")?.value || "";
      const mobile = document.getElementById("searchInputMobile")?.value || "";
      return desktop || mobile;
    }

    function loadProducts(category = "all", search = "") {
      currentCategory = category;
      const grid = document.getElementById("productsGrid");
      const products = API.getProducts(category, search);

      document.getElementById("productsMeta").textContent = `${products.length} item(s)`;

      if (products.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
            <p class="text-gray-500 text-xl">No products found</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = products.map(p => `
        <div class="product-card bg-white rounded-xl shadow-md overflow-hidden cursor-pointer" onclick="showProductDetail(${p.id})">
          <div class="relative">
            <img src="${p.image}" alt="${escapeHtml(p.name)}" class="w-full h-48 object-cover">
            <span class="absolute top-2 right-2 bg-indigo-600 text-white text-xs px-2 py-1 rounded-full">${p.category}</span>
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-gray-800 mb-2">${escapeHtml(p.name)}</h3>
            <div class="flex items-center mb-2">
              ${generateStars(p.rating)}
              <span class="text-gray-500 text-sm ml-2">(${Number(p.rating).toFixed(1)})</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-2xl font-bold text-indigo-600">$${Number(p.price).toFixed(2)}</span>
              <button onclick="event.stopPropagation(); addToCart(${p.id})"
                class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                <i class="fas fa-cart-plus"></i>
              </button>
            </div>
            <p class="text-sm text-gray-500 mt-2">
              <i class="fas fa-box mr-1"></i>${Number(p.stock)} in stock
            </p>
          </div>
        </div>
      `).join("");
    }

    function filterCategory(category) {
      document.querySelectorAll(".category-btn").forEach(btn => {
        if (btn.dataset.category === category) {
          btn.classList.remove("bg-gray-200", "text-gray-700");
          btn.classList.add("bg-indigo-600", "text-white");
        } else {
          btn.classList.remove("bg-indigo-600", "text-white");
          btn.classList.add("bg-gray-200", "text-gray-700");
        }
      });
      loadProducts(category, getSearchQuery());
    }

    function addToCart(productId) {
      const product = API.getProduct(productId);
      if (!product) return showToast("Product not found", "error");
      if (Number(product.stock) <= 0) return showToast("Out of stock", "error");

      const cart = API.getCart();
      const existing = cart.find(i => i.productId === productId);

      // stock check (cart quantity cannot exceed stock)
      const currentQty = existing ? existing.quantity : 0;
      if (currentQty + 1 > Number(product.stock)) {
        return showToast("Insufficient stock", "error");
      }

      if (existing) existing.quantity += 1;
      else cart.push({ productId, name: product.name, price: Number(product.price), image: product.image, quantity: 1 });

      API.saveCart(cart);
      updateCartBadge();
      showToast("Added to cart!", "success");
    }

    function updateCartBadge() {
      const cart = API.getCart();
      const totalItems = cart.reduce((sum, i) => sum + Number(i.quantity), 0);
      const badge = document.getElementById("cartBadge");
      if (totalItems > 0) {
        badge.textContent = totalItems;
        badge.classList.remove("hidden");
      } else badge.classList.add("hidden");
    }

    function showCart() {
      const cart = API.getCart();
      const cartItems = document.getElementById("cartItems");

      if (cart.length === 0) {
        cartItems.innerHTML = `
          <div class="text-center py-8">
            <i class="fas fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
            <p class="text-gray-500 text-xl">Your cart is empty</p>
          </div>`;
      } else {
        cartItems.innerHTML = cart.map(item => `
          <div class="flex items-center space-x-4 py-4 border-b">
            <img src="${item.image}" class="w-20 h-20 object-cover rounded-lg" />
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${escapeHtml(item.name)}</h4>
              <p class="text-indigo-600 font-bold">$${Number(item.price).toFixed(2)}</p>
            </div>
            <div class="flex items-center space-x-2">
              <button onclick="updateQuantity(${item.productId}, ${item.quantity - 1})"
                class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center">
                <i class="fas fa-minus text-sm"></i>
              </button>
              <span class="w-8 text-center font-semibold">${item.quantity}</span>
              <button onclick="updateQuantity(${item.productId}, ${item.quantity + 1})"
                class="w-8 h-8 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center">
                <i class="fas fa-plus text-sm"></i>
              </button>
            </div>
            <button onclick="removeFromCart(${item.productId})" class="text-red-500 hover:text-red-700">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `).join("");
      }

      document.getElementById("cartTotal").textContent = `$${cartTotal(cart).toFixed(2)}`;
      document.getElementById("cartModal").classList.remove("hidden");
    }

    function hideCart() {
      document.getElementById("cartModal").classList.add("hidden");
    }

    function updateQuantity(productId, quantity) {
      const cart = API.getCart();
      const idx = cart.findIndex(i => i.productId === productId);
      if (idx === -1) return;

      const product = API.getProduct(productId);
      const maxStock = product ? Number(product.stock) : 0;

      if (quantity <= 0) {
        cart.splice(idx, 1);
      } else {
        if (quantity > maxStock) {
          showToast("Insufficient stock", "error");
          cart[idx].quantity = maxStock; // clamp
        } else {
          cart[idx].quantity = quantity;
        }
      }

      API.saveCart(cart);
      updateCartBadge();
      showCart();
    }

    function removeFromCart(productId) {
      const cart = API.getCart().filter(i => i.productId !== productId);
      API.saveCart(cart);
      updateCartBadge();
      showCart();
      showToast("Item removed", "info");
    }

    function checkout() {
      const cart = API.getCart();
      if (cart.length === 0) return showToast("Your cart is empty", "error");

      document.getElementById("checkoutTotal").textContent = `$${cartTotal(cart).toFixed(2)}`;
      hideCart();
      document.getElementById("checkoutModal").classList.remove("hidden");
    }

    function hideCheckout() {
      document.getElementById("checkoutModal").classList.add("hidden");
    }

    function placeOrder() {
      const cart = API.getCart();
      if (cart.length === 0) return showToast("Cart is empty", "error");

      // Verify stock before placing order
      const products = readJSON(STORAGE_KEY_PRODUCTS, []);
      for (const item of cart) {
        const p = products.find(x => x.id === item.productId);
        if (!p) return showToast("Some items are no longer available", "error");
        if (Number(p.stock) < Number(item.quantity)) {
          return showToast(`Insufficient stock for: ${p.name}`, "error");
        }
      }

      // Deduct stock
      for (const item of cart) {
        const p = products.find(x => x.id === item.productId);
        p.stock = Number(p.stock) - Number(item.quantity);
      }
      API.saveProducts(products);

      const total = cartTotal(cart);
      const customer = {
        name: document.getElementById("coName").value.trim(),
        email: document.getElementById("coEmail").value.trim(),
        address: document.getElementById("coAddress").value.trim()
      };

      const orders = API.getOrders();
      orders.unshift({
        id: Date.now(),
        date: new Date().toISOString(),
        status: "Processing",
        items: cart,
        total,
        customer
      });
      API.saveOrders(orders);

      // clear cart
      API.saveCart([]);
      updateCartBadge();
      hideCheckout();

      // refresh products (stock changed)
      loadProducts(currentCategory, getSearchQuery());

      showToast("Order placed successfully!", "success");
      setTimeout(showOrders, 700);
    }

    function showOrders() {
      const orders = API.getOrders();
      const ordersList = document.getElementById("ordersList");

      if (orders.length === 0) {
        ordersList.innerHTML = `
          <div class="text-center py-8">
            <i class="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
            <p class="text-gray-500 text-xl">No orders yet</p>
          </div>`;
      } else {
        ordersList.innerHTML = orders.map(o => `
          <div class="border rounded-xl p-4 mb-4">
            <div class="flex justify-between items-center mb-3">
              <span class="font-semibold text-gray-800">Order #${o.id}</span>
              <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">${o.status}</span>
            </div>
            <div class="space-y-2">
              ${o.items.map(it => `
                <div class="flex items-center space-x-3">
                  <img src="${it.image}" class="w-12 h-12 rounded object-cover"/>
                  <span class="flex-1">${escapeHtml(it.name)} x ${it.quantity}</span>
                  <span class="font-semibold">$${(Number(it.price) * Number(it.quantity)).toFixed(2)}</span>
                </div>
              `).join("")}
            </div>
            <div class="border-t mt-3 pt-3 flex justify-between">
              <span class="text-gray-500">${new Date(o.date).toLocaleString()}</span>
              <span class="font-bold text-indigo-600">Total: $${Number(o.total).toFixed(2)}</span>
            </div>
          </div>
        `).join("");
      }

      document.getElementById("ordersModal").classList.remove("hidden");
    }

    function hideOrders() {
      document.getElementById("ordersModal").classList.add("hidden");
    }

    function showProductDetail(productId) {
      const p = API.getProduct(productId);
      if (!p) return;

      document.getElementById("productDetail").innerHTML = `
        <button onclick="hideProductDetail()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
          <i class="fas fa-times text-2xl"></i>
        </button>

        <div class="grid md:grid-cols-2 gap-6">
          <img src="${p.image}" alt="${escapeHtml(p.name)}" class="w-full h-80 object-cover rounded-xl" />
          <div>
            <span class="inline-block bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm mb-3">${p.category}</span>
            <h2 class="text-2xl font-bold text-gray-800 mb-3">${escapeHtml(p.name)}</h2>
            <div class="flex items-center mb-4">
              ${generateStars(p.rating)}
              <span class="text-gray-500 ml-2">(${Number(p.rating).toFixed(1)} rating)</span>
            </div>
            <p class="text-gray-600 mb-4">${escapeHtml(p.description)}</p>
            <p class="text-3xl font-bold text-indigo-600 mb-4">$${Number(p.price).toFixed(2)}</p>
            <p class="text-gray-500 mb-6"><i class="fas fa-box mr-2"></i>${Number(p.stock)} items in stock</p>

            <button onclick="addToCart(${p.id}); hideProductDetail();"
              class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-xl font-semibold hover:opacity-90 transition">
              <i class="fas fa-cart-plus mr-2"></i>Add to Cart
            </button>
          </div>
        </div>
      `;

      document.getElementById("productModal").classList.remove("hidden");
    }

    function hideProductDetail() {
      document.getElementById("productModal").classList.add("hidden");
    }

    function generateStars(rating) {
      rating = Number(rating) || 0;
      let stars = "";
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) stars += '<i class="fas fa-star text-yellow-400"></i>';
        else if (i - 0.5 <= rating) stars += '<i class="fas fa-star-half-alt text-yellow-400"></i>';
        else stars += '<i class="far fa-star text-yellow-400"></i>';
      }
      return stars;
    }

    function cartTotal(cart) {
      return cart.reduce((sum, i) => sum + (Number(i.price) * Number(i.quantity)), 0);
    }

    function showToast(message, type="info") {
      const container = document.getElementById("toastContainer");
      const colors = { success:"bg-green-500", error:"bg-red-500", info:"bg-blue-500" };
      const icons = { success:"fa-check-circle", error:"fa-exclamation-circle", info:"fa-info-circle" };

      const toast = document.createElement("div");
      toast.className = `toast ${colors[type] || colors.info} text-white px-5 py-3 rounded-lg shadow-lg flex items-center space-x-2`;
      toast.innerHTML = `<i class="fas ${icons[type] || icons.info}"></i><span>${escapeHtml(message)}</span>`;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // close modals on outside click
    document.querySelectorAll(".modal").forEach(modal => {
      modal.addEventListener("click", function(e){
        if (e.target === this) this.classList.add("hidden");
      });
    });
  </script>
</body>
</html>