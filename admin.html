<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PyShop - Admin Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    .toast{ animation:slideIn .25s ease, fadeOut .25s ease 2.7s; }
    @keyframes slideIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }
    @keyframes fadeOut { from{opacity:1} to{opacity:0} }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">
  <!-- NAV -->
  <nav class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <i class="fab fa-python text-3xl"></i>
        <h1 class="text-2xl font-bold">PyShop Admin</h1>
      </div>

      <div class="flex items-center gap-3">
        <a href="./user.html" class="px-4 py-2 rounded-xl bg-white/15 hover:bg-white/25 transition">
          <i class="fas fa-store mr-2"></i>Open Shop
        </a>
        <button onclick="resetToDefault()" class="px-4 py-2 rounded-xl bg-red-500/80 hover:bg-red-500 transition">
          <i class="fas fa-rotate-left mr-2"></i>Reset Default
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <div class="grid lg:grid-cols-3 gap-6">
      <!-- FORM -->
      <section class="bg-white rounded-2xl shadow p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 id="formTitle" class="text-xl font-bold text-gray-800">Add Product</h2>
          <button onclick="clearForm()" class="text-sm px-3 py-1 rounded-lg bg-gray-100 hover:bg-gray-200">
            Clear
          </button>
        </div>

        <form id="productForm" class="space-y-3">
          <input type="hidden" id="pid"/>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
            <input id="name" required class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Price</label>
              <input id="price" type="number" step="0.01" min="0" required
                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Stock</label>
              <input id="stock" type="number" step="1" min="0" required
                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
            <input id="image" required
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
            <div class="mt-2">
              <img id="preview" class="w-full h-40 object-cover rounded-xl border hidden" alt="preview"/>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
              <select id="category" required
                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                <option value="electronics">electronics</option>
                <option value="clothing">clothing</option>
                <option value="home">home</option>
                <option value="sports">sports</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Rating (0-5)</label>
              <input id="rating" type="number" step="0.1" min="0" max="5" required
                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea id="description" rows="3" required
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
          </div>

          <button type="submit"
            class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-2.5 rounded-xl font-semibold hover:opacity-90 transition">
            <i class="fas fa-save mr-2"></i>Save
          </button>
        </form>
      </section>

      <!-- LIST -->
      <section class="bg-white rounded-2xl shadow p-6 lg:col-span-2">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-xl font-bold text-gray-800">Manage Products</h2>
            <p id="meta" class="text-sm text-gray-500"></p>
          </div>

          <div class="flex items-center gap-2">
            <input id="search" placeholder="Search..."
              class="px-4 py-2 border rounded-xl focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
          </div>
        </div>

        <div class="border rounded-xl overflow-hidden">
          <div class="grid grid-cols-12 bg-gray-50 px-4 py-2 text-sm font-semibold text-gray-600">
            <div class="col-span-5">Product</div>
            <div class="col-span-2">Price</div>
            <div class="col-span-2">Stock</div>
            <div class="col-span-3 text-right">Actions</div>
          </div>
          <div id="list" class="max-h-[70vh] overflow-y-auto"></div>
        </div>
      </section>
    </div>
  </main>

  <div id="toastContainer" class="fixed top-20 right-4 z-50 space-y-2"></div>

  <script>
    // =============================
    // STORAGE KEYS (shared with user.html)
    // =============================
    const STORAGE_KEY_PRODUCTS = "pyshop_products_v1";

    const DEFAULT_PRODUCTS = [
      { id: 1, name: "Wireless Headphones", price: 79.99, category: "electronics", image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop", rating: 4.5, stock: 50, description: "Premium wireless headphones with noise cancellation and 30-hour battery life." },
      { id: 2, name: "Smart Watch Pro", price: 199.99, category: "electronics", image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=300&h=300&fit=crop", rating: 4.8, stock: 30, description: "Advanced smartwatch with health monitoring, GPS, and 7-day battery." },
      { id: 3, name: "Bluetooth Mouse", price: 49.99, category: "electronics", image: "https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=300&h=300&fit=crop", rating: 4.3, stock: 100, description: "Smooth Bluetooth mouse with ergonomic grip and long battery." },
      { id: 4, name: "Mechanical Keyboard", price: 129.99, category: "electronics", image: "https://images.unsplash.com/photo-1511467687858-23d96c32e4ae?w=300&h=300&fit=crop", rating: 4.7, stock: 45, description: "RGB mechanical keyboard with tactile switches and programmable keys." },
      { id: 5, name: "Cotton T-Shirt", price: 24.99, category: "clothing", image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=300&h=300&fit=crop", rating: 4.2, stock: 200, description: "Comfortable 100% organic cotton t-shirt." },
      { id: 6, name: "Denim Jacket", price: 89.99, category: "clothing", image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=300&h=300&fit=crop", rating: 4.6, stock: 60, description: "Classic denim jacket with modern fit and vintage wash." },
      { id: 7, name: "Running Shoes", price: 119.99, category: "sports", image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop", rating: 4.9, stock: 80, description: "Lightweight running shoes with responsive cushioning." },
      { id: 8, name: "Yoga Mat", price: 34.99, category: "sports", image: "https://images.unsplash.com/photo-1601925260368-ae2f83cf8b7f?w=300&h=300&fit=crop", rating: 4.4, stock: 150, description: "Non-slip yoga mat with carrying strap." },
      { id: 9, name: "Plant Pot Set", price: 29.99, category: "home", image: "https://images.unsplash.com/photo-1485955900006-10f4d324d411?w=300&h=300&fit=crop", rating: 4.5, stock: 90, description: "Set of 3 ceramic plant pots with drainage holes." },
      { id: 10, name: "LED Desk Lamp", price: 44.99, category: "home", image: "https://images.unsplash.com/photo-1507473885765-e6ed057f782c?w=300&h=300&fit=crop", rating: 4.6, stock: 70, description: "Adjustable LED desk lamp with touch controls." }
    ];

    // -----------------------------
    // localStorage helpers
    // -----------------------------
    function readProducts() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY_PRODUCTS);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function writeProducts(products) {
      localStorage.setItem(STORAGE_KEY_PRODUCTS, JSON.stringify(products));
    }

    function ensureSeed() {
      const p = readProducts();
      if (!p.length) writeProducts(DEFAULT_PRODUCTS);
    }

    // -----------------------------
    // UI
    // -----------------------------
    document.addEventListener("DOMContentLoaded", () => {
      ensureSeed();
      render();

      document.getElementById("productForm").addEventListener("submit", (e) => {
        e.preventDefault();
        saveProduct();
      });

      document.getElementById("search").addEventListener("input", () => render());

      document.getElementById("image").addEventListener("input", () => {
        const url = document.getElementById("image").value.trim();
        const img = document.getElementById("preview");
        if (!url) { img.classList.add("hidden"); img.src = ""; return; }
        img.src = url;
        img.classList.remove("hidden");
      });
    });

    function render() {
      const q = (document.getElementById("search").value || "").toLowerCase().trim();
      const list = document.getElementById("list");
      let products = readProducts();

      if (q) products = products.filter(p => (p.name || "").toLowerCase().includes(q));

      document.getElementById("meta").textContent = `${products.length} product(s)`;

      list.innerHTML = products.map(p => `
        <div class="grid grid-cols-12 px-4 py-3 border-t items-center">
          <div class="col-span-5 flex items-center gap-3">
            <img src="${p.image}" class="w-10 h-10 rounded object-cover border"/>
            <div>
              <div class="font-semibold text-gray-800">${escapeHtml(p.name)}</div>
              <div class="text-xs text-gray-500">${p.category} • ⭐ ${Number(p.rating).toFixed(1)}</div>
            </div>
          </div>
          <div class="col-span-2 font-semibold text-indigo-600">$${Number(p.price).toFixed(2)}</div>
          <div class="col-span-2 text-gray-700">${Number(p.stock)}</div>
          <div class="col-span-3 text-right space-x-2">
            <button onclick="edit(${p.id})" class="px-3 py-1 rounded-lg bg-gray-100 hover:bg-gray-200 text-sm">
              <i class="fas fa-pen mr-1"></i>Edit
            </button>
            <button onclick="del(${p.id})" class="px-3 py-1 rounded-lg bg-red-50 hover:bg-red-100 text-red-600 text-sm">
              <i class="fas fa-trash mr-1"></i>Delete
            </button>
          </div>
        </div>
      `).join("");
    }

    function clearForm() {
      document.getElementById("formTitle").textContent = "Add Product";
      document.getElementById("pid").value = "";
      document.getElementById("name").value = "";
      document.getElementById("price").value = "";
      document.getElementById("stock").value = "";
      document.getElementById("image").value = "";
      document.getElementById("category").value = "electronics";
      document.getElementById("rating").value = "4.5";
      document.getElementById("description").value = "";
      document.getElementById("preview").classList.add("hidden");
      document.getElementById("preview").src = "";
    }

    function edit(id) {
      const products = readProducts();
      const p = products.find(x => x.id === id);
      if (!p) return;

      document.getElementById("formTitle").textContent = "Edit Product";
      document.getElementById("pid").value = p.id;
      document.getElementById("name").value = p.name;
      document.getElementById("price").value = p.price;
      document.getElementById("stock").value = p.stock;
      document.getElementById("image").value = p.image;
      document.getElementById("category").value = p.category;
      document.getElementById("rating").value = p.rating;
      document.getElementById("description").value = p.description;

      const img = document.getElementById("preview");
      img.src = p.image;
      img.classList.remove("hidden");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function saveProduct() {
      const idRaw = document.getElementById("pid").value;
      const payload = {
        name: document.getElementById("name").value.trim(),
        price: Number(document.getElementById("price").value),
        stock: Number(document.getElementById("stock").value),
        image: document.getElementById("image").value.trim(),
        category: document.getElementById("category").value,
        rating: Number(document.getElementById("rating").value),
        description: document.getElementById("description").value.trim()
      };

      // basic validation
      if (!payload.name || !payload.image || !payload.description) return showToast("Please fill all fields", "error");
      if (payload.price < 0 || payload.stock < 0 || payload.rating < 0 || payload.rating > 5) return showToast("Invalid values", "error");

      const products = readProducts();

      if (idRaw) {
        const id = Number(idRaw);
        const p = products.find(x => x.id === id);
        if (!p) return showToast("Product not found", "error");

        Object.assign(p, payload);
        writeProducts(products);
        showToast("Product updated", "success");
      } else {
        const nextId = products.reduce((m, p) => Math.max(m, p.id), 0) + 1;
        products.unshift({ id: nextId, ...payload });
        writeProducts(products);
        showToast("Product added", "success");
      }

      clearForm();
      render();
    }

    function del(id) {
      if (!confirm("Delete this product?")) return;
      let products = readProducts();
      products = products.filter(p => p.id !== id);
      writeProducts(products);
      showToast("Product deleted", "info");
      render();
    }

    function resetToDefault() {
      if (!confirm("Reset products to default list?")) return;
      writeProducts(DEFAULT_PRODUCTS);
      clearForm();
      render();
      showToast("Reset done", "success");
    }

    function showToast(message, type="info") {
      const container = document.getElementById("toastContainer");
      const colors = { success:"bg-green-500", error:"bg-red-500", info:"bg-blue-500" };
      const icons = { success:"fa-check-circle", error:"fa-exclamation-circle", info:"fa-info-circle" };

      const toast = document.createElement("div");
      toast.className = `toast ${colors[type] || colors.info} text-white px-5 py-3 rounded-lg shadow-lg flex items-center space-x-2`;
      toast.innerHTML = `<i class="fas ${icons[type] || icons.info}"></i><span>${escapeHtml(message)}</span>`;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  </script>
</body>
</html>